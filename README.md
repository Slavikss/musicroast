# musicroast

Проект musicroast - сервис для генерации юмористических "прожарок" на основе музыкальной библиотеки пользователя.

## Установка

1. Установите зависимости с помощью Poetry:
```bash
poetry install
```

2. Создайте файл `.env` в корне проекта со следующими переменными:
```
GOOGLE_API_KEY=ваш_ключ_google_gemini_api
PROMPT_CONFIG_PATH=путь_к_json_конфигу_промптов(опционально)
```

Ключи доступа к потоковым сервисам (Яндекс Музыка, Spotify, Apple Music и др.) передаются приложению напрямую в запросах и не сохраняются на сервере.


## Запуск

```bash
poetry run python main.py
```

Сервис будет доступен по адресу: http://localhost:8000

## API Endpoints

- POST `/streaming/playlists` — принимает `provider` и `access_token`, возвращает список доступных плейлистов выбранного стриминга и доступные версии промптов.
- POST `/streaming/playlist-info` — принимает `provider`, `access_token` и `playlist_kind`, возвращает нормализованные данные выбранного плейлиста.
- POST `/roast` — принимает данные стриминга, идентификатор плейлиста, опциональную `prompt_version` и флаг `generate_image`, генерирует прожарку и, при необходимости, изображение.

## Заметки

- Используется Google Gemini Pro с параметрами temperature=0.9 и top_p=0.95 для оптимального баланса креативности и связности текста
- Для работы требуется ключ Google Gemini API и действующий токен выбранного потокового сервиса


## Реализованный функционал
- ООП-архитектура: единый абстрактный слой для стримингов (Яндекс, Spotify, Apple Music) плюс сервисы нормализации треков, управления промптами и генерации прожарок.
- PromptManager с версионированием и загрузкой конфигурации из JSON-файла через `PROMPT_CONFIG_PATH`.
- Безопасная работа с пользовательскими токенами: они передаются только в запросах и не сохраняются на сервере.
- FastAPI эндпоинты `/streaming/playlists`, `/streaming/playlist-info` и `/roast`, поддерживающие генерацию текста и изображений.


## TODO(non-coding)
1. выявить еще 3 стиля прожарки плейлиста юзера, включая:
    - оценка плейлиста юзера по всем каноничным критериям РЗТ + итоговая оценка + итоговое описывающее словосочетание

## TODO(coding)
1. Сделать продуктизированную обертку для бота(на этом этапе - тг бот на aiogram):
    - асинхронным

    - флоу такой: /start юзера -> онбординг-приветственное сообщение в дружелюбном тоне -> просьба перейти юзера перейти по ссылке(вот этой https://oauth.yandex.ru/authorize?response_type=token&client_id=1a6990aa636648e9b2ef855fa7bec2fb), авторизоваться в яндекс аккаунте на котором яндекс музыке, скопировать там код и вставить получившийся обратно в бота -> бот отбивает что получил/не получил, затем кнопка прожарить -> юзер нажимает, появляется сообщение про ожидание небольшое -> как генерируется, выдаётся юзеру в форматированном markdown стиле
